(function(){function a(){var c="Internet";var p,j,m;function o(){if(!p){if(typeof(Media)=="undefined"){p=new n(function(){m.onend()},function(){m.onerror()},function(){m.onprogress()})}else{this.tts=new f(function(){m.onend()},function(){m.onerror()},function(){m.onprogress()})}}return true}function q(){m=pkrss.utils.tts;if(!o()){return}}function d(s){if(!o()){s(null,c);return false}if(!j){pkrss.ajax.getPkCache({task:"getTTSList"},function(v,u){if(v){for(var t in v){v[t].downloadCapable=true}j=v}if(s){s(j,c)}},function(){s(j,c)},"json")}else{if(s){s(j,c)}}return true}function r(s){}function h(s){k(s,function(t){if(t){p.playAudio(t)}else{m.onerror()}});return true}function k(t,s){if(!s){return}if(!t||(t=="")){s(null);return}if(!j){d(function(u){g(t,s);t=null;s=null})}else{g(t,s)}}function g(w,s){var u;var v=pkrss.model.locale.getlocaleinfobyid(pkrss.profile.usersetting.selectedLId);if(j&&v){u=pkrss.profile.usersetting.locale2tts[v.id];if(!u||(u=="")){for(var t in j){if(j[t].locale==v.locale){if(j[t].tts&&j[t].tts.length){u=j[t].tts[0].id}break}}}if(!u||(u=="")){for(var t in j){if(m._filterLocaleString(j[t].locale)==m._filterLocaleString(v.locale)){if(j[t].tts&&j[t].tts.length){u=j[t].tts[0].id}break}}}}if(!u){s(null);return}pkrss.ajax.getAshxData({task:"getfileurl",tts:u,text:w},function(x){s((x&&(x.code==0)&&x.url)?x.url:null);s=null},function(x){s(null);s=null},"POST")}function f(G,D,w){var z=null;var s=null;var v=G;var t=D;var y=w;function u(H){z=new Media(H,E,C);z.play();console.log("TTSGetList: media playAudio："+H);if(s==null){s=setInterval(function(){z.getCurrentPosition(function(I){if(I>-1){w(I)}},function(I){w(0)})},1000)}}function A(){if(z){z.pause()}}function F(){if(z){z.stop()}clearInterval(s);s=null}function E(){v()}function C(H){t()}function x(H){if(z){z.muted=H}}function B(H){if(z){z.volume=H}}return{my_media:z,playAudio:u,pauseAudio:A,stopAudio:F,mute:x,volume:B}}function n(F,C,v){var y=null;var u=F;var s=C;var x=v;function t(G){if(!y){y=document.createElement("audio");y.addEventListener("progress",function(){v()},false);y.addEventListener("ended",function(){F()},false);y.addEventListener("pause",function(){m.onpause()},false);y.addEventListener("suspend",function(){m.onsuspend()},false);y.addEventListener("error",function(){C()},false)}console.log("TTSGetList: html5 playAudio："+G);y.src=G;y.play()}function z(){if(y){y.pause()}}function E(){if(y){y.pause()}}function D(){u()}function B(G){s()}function w(G){if(y){y.muted=G}}function A(G){if(y){y.volume=G}}return{my_media:y,playAudio:t,pauseAudio:z,stopAudio:E,mute:w,volume:A}}function l(){if(p){p.stopAudio()}}function e(s){}function i(s){}return{name:c,init:q,getTTSList:d,setCurrentTTS:r,speak:h,stop:l,mute:e,volume:i}}var b=new pkrss.utils.tts.base();pkrss.extend(b,new a());pkrss.utils.tts.factory.regist(b);pkrss.define("pkrss.utils.tts",{pkrss:b})})();