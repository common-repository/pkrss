pkrss.cls.tts_base=function(){};pkrss.cls.tts_base.prototype.init=function(){};pkrss.cls.tts_base.prototype.getTTSList=function(a){a(null,"Base");return false};pkrss.cls.tts_base.prototype.setCurrentTTS=function(a){};pkrss.cls.tts_base.prototype.speak=function(a){return false};pkrss.cls.tts_base.prototype.stop=function(){};pkrss.cls.tts_base.prototype.mute=function(a){};pkrss.cls.tts_base.prototype.volume=function(a){};pkrss.cls.tts_factory=function(){this.data=[]};pkrss.cls.tts_factory.prototype.regist=function(b,a){if(a){this.data.splice(0,0,b)}else{this.data.push(b)}};pkrss.cls.tts_factory.prototype.find=function(a){for(var b=0,d=this.data.length;b<d;++b){if(this.data[b].name==a){return this.data[b]}}return null};pkrss.cls.tts_factory.prototype.init=function(a){this.init2(0,a)};pkrss.cls.tts_factory.prototype.init2=function(c,a){if(c>=this.data.length){if(a){a()}return}var b=this;this.data[c].init(function(d){b.init2(c+1,a);b=null})};pkrss.cls.tts=function(){this.factory=new pkrss.cls.tts_factory();this.playing=false,this.tts=null;this.autonext=false;this.ttsengeerlist=null;this.successNormal=false};pkrss.cls.tts.prototype.init=function(){this.ttsengeerlist=this.factory.data;this.factory.init();if(!this.tts&&this.ttsengeerlist.length){this.tts=this.ttsengeerlist[0]}};pkrss.cls.tts.prototype.onend=function(){if(!this.tts){return}var a=this.playing;this.playing=false;if(pkrss.notification){pkrss.notification.hide()}pkrss.event.trigger(pkrss.event.value.tts.ended);if(this.autonext&&a&&this.successNormal){this.speaknext()}};pkrss.cls.tts.prototype.onprogress=function(){pkrss.event.trigger(pkrss.event.value.tts.progress)};pkrss.cls.tts.prototype.onpause=function(){pkrss.event.trigger(pkrss.event.value.tts.pause)};pkrss.cls.tts.prototype.onsuspend=function(){pkrss.event.trigger(pkrss.event.value.tts.suspend)};pkrss.cls.tts.prototype.onerror=function(){pkrss.event.trigger(pkrss.event.value.tts.error)};pkrss.cls.tts.prototype.speakitem=function(a){if(!a){return}this.speak(this.getspeaktext(a))};pkrss.cls.tts.prototype.getspeaktext=function(h){var e=pkrss.model.rssitem.getItemById(h);var b=" ";if(!e){return b}if(pkrss.plateform.runtime.apType==pkrss.plateform.runtime.aptype_pkstock2){b+=pkgetLocaleString("No")+":"+(h+1);if(pkrss.profile.usersetting.settingDetailShowAuthor){b+=" "+pkgetLocaleString("Author")+":"+e.author}if(pkrss.profile.usersetting.settingDetailShowDate){var f="";if(e&&e.publishedDate){var d=new Date(e.publishedDate);f=d.toLocaleDateString()+" "+d.toLocaleTimeString()}b+=" "+pkgetLocaleString("Date")+":"+f}if(pkrss.profile.usersetting.settingDetailShowCatalogs){b+=" "+pkgetLocaleString("Catalogs")+":";if(e&&e.catalogs){for(var a=0,g=e.catalogs.length;a<g;++a){b+=e.catalogs[a]}}}if(pkrss.profile.usersetting.settingDetailShowTitle){b+=" "+pkgetLocaleString("Title")+":"+(e?e.title:"")}if(pkrss.profile.usersetting.settingDetailShowSnippet){b+=" "+pkgetLocaleString("Snippet")+":"+(e?e.contentSnippet:"")}if(pkrss.profile.usersetting.settingDetailShowContent){b+=" "+pkgetLocaleString("Content")+":"+(e?e.content:"")}}else{b+=" "+pkgetLocaleString("Title")+":"+(e?e.title:"");b+=" "+pkgetLocaleString("Content")+":"+(e?e.content:"")}return b};pkrss.cls.tts.prototype.speak=function(d,b){if(!this.tts){return}d=pkrss.utils.html.replaceHtmlEntites(d);this.autonext=b;this.playing=true;this.successNormal=true;if(!this.tts.speak(d)){var c;for(var a in this.ttsengeerlist){c=this.ttsengeerlist[a];if(c!=this.tts){if(this.tts2.speak(d)){break}}}}pkrss.event.trigger(pkrss.event.value.tts.play)};pkrss.cls.tts.prototype.speaknext=function(){};pkrss.cls.tts.prototype.pause=function(){this.stop()};pkrss.cls.tts.prototype.stop=function(){if(!this.tts||!this.playing){return}this.playing=false;this.successNormal=false;this.tts.stop()};pkrss.cls.tts.prototype.isplaying=function(){return this.playing};pkrss.cls.tts.prototype.isSuccessNormal=function(){return this.successNormal};pkrss.cls.tts.prototype.mute=function(a){if(!this.tts){return}this.tts.mute(a)};pkrss.cls.tts.prototype.volume=function(a){if(!this.tts){return}this.tts.volume(a)};pkrss.cls.tts.prototype.getTTSList=function(a){var b=[];this._getTTSList([],a,b);return true};pkrss.cls.tts.prototype._getTTSList=function(f,a,e){var d;for(var c in this.ttsengeerlist){d=this.ttsengeerlist[c];if(pkrss.inArray(d,f)<0){break}d=null}if(!d){a(e);return}f.push(d);var b=this;d.getTTSList(function(n,k){if(n){var g;var m;for(var l in n){m=n[l];for(var h in m.tts){if(!m.tts[h].group){m.tts[h].group=k}}g=null;for(var h in e){if(e[h].locale==m.locale){g=e[h];break}}if(g){if(!g.tts){g.tts=[]}g.tts=g.tts.concat(m.tts)}else{e.push(m)}}}b._getTTSList(f,a,e);e=null;f=null;a=null})};pkrss.cls.tts.prototype.setCurrentTTS=function(a,b){pkrss.profile.usersetting.curTTSInfo={tts:a,ttsval:b};pkrss.profile.saveUserData();if(!this.tts||(a!=this.tts.name)){this.tts=this.factory.find(a);if(!this.tts&&this.ttsengeerlist.length){this.tts=this.ttsengeerlist[0]}}if(this.tts){this.tts.setCurrentTTS(b)}};pkrss.cls.tts.prototype._filterLocaleString=function(a){var b=a.indexOf("_");if(b>=0){a=a.substring(0,b)}return a};pkrss.cls.tts.prototype.removeengine=function(a){var d=this.factory.data;for(var b=0,e=d.length;b<e;++b){if(d[b].name==a){d.splice(b,1);if(this.tts.name==a){if(d.length){this.tts=d[0]}else{this.tts=null}}break}}};pkrss.define("pkrss.utils",{tts:new pkrss.cls.tts()});var pkrssspeak=pkrss.utils.tts;pkrss.define("pkrss.utils.tts",{event:pkrss.event,base:pkrss.cls.tts_base});pkrss.define("pkrss.utils.tts.event",{eventType:{progress:"pktts_progress",play:"pktts_play",pause:"pktts_pause",playing:"pktts_playing",ended:"pktts_ended",suspend:"pktts_suspend",error:"pktts_error"}});pkrss.define("pkrss.event.value",{tts:pkrss.utils.tts.event.eventType});