(function(a){a.prompt=function(l,m){if(m!==undefined&&m.classes!=undefined&&typeof m.classes==="string"){m={box:m.classes}}a.prompt.options=a.extend({},a.prompt.defaults,m);a.prompt.currentPrefix=a.prompt.options.prefix;var b=a.prompt.options,g=a(document.body),d=a(window);var c='<div class="'+a.prompt.options.prefix+"box "+b.classes.box+'">';if(b.useiframe&&(a("object, applet").length>0)){c+='<iframe src="javascript:false;" style="display:block;position:absolute;z-index:-1;" class="'+b.prefix+"fade "+b.classes.fade+'"></iframe>'}else{c+='<div class="'+b.prefix+"fade "+b.classes.fade+'"></div>'}c+='<div class="'+b.prefix+" "+b.classes.prompt+'"><div class="'+b.prefix+'container"><div class="';c+=b.prefix+"close "+b.classes.close+'">'+b.closeText+'</div><div class="'+b.prefix+'states"></div>';c+="</div></div></div>";a.prompt.jqib=a(c).appendTo(g);a.prompt.jqi=a.prompt.jqib.children("."+b.prefix).data("jqi",b);a.prompt.jqif=a.prompt.jqib.children("."+b.prefix+"fade");if(l.constructor==String){l={state0:{title:b.title,html:l,buttons:b.buttons,position:b.position,focus:b.focus,submit:b.submit}}}var f,j;for(f in l){j=a.extend({},a.prompt.defaults.state,{name:f},l[f]);a.prompt.addState(j.name,j);if(a.prompt.currentStateName===""){a.prompt.currentStateName=j.name}}var e=a.prompt.jqi.find("."+b.prefix+"states ."+b.prefix+"state:first");a.prompt.goToState(e.data("jqi").name);a.prompt.jqi.delegate("."+b.prefix+"buttons button","click",function(s){var q=a(this),k=q.parents("."+b.prefix+"state"),u=k.data("jqi"),p=k.children("."+b.prefix+"message"),t=u.buttons[q.text()]||u.buttons[q.html()],n={};if(t==undefined){for(var r in u.buttons){if(u.buttons[r].title==q.text()||u.buttons[r].title==q.html()){t=u.buttons[r].value}}}a.each(a.prompt.jqi.find("."+b.prefix+"states :input").serializeArray(),function(v,w){if(n[w.name]===undefined){n[w.name]=w.value}else{if(typeof n[w.name]==Array||typeof n[w.name]=="object"){n[w.name].push(w.value)}else{n[w.name]=[n[w.name],w.value]}}});var o=new a.Event("promptsubmit");o.stateName=u.name;o.state=k;k.trigger(o,[t,p,n]);if(!o.isDefaultPrevented()){a.prompt.close(true,t,p,n)}});var i=function(){if(b.persistent){var n=(b.top.toString().indexOf("%")>=0?(d.height()*(parseInt(b.top,10)/100)):parseInt(b.top,10)),k=parseInt(a.prompt.jqi.css("top").replace("px",""),10)-n;a("html,body").animate({scrollTop:k},"fast",function(){var p=0;a.prompt.jqib.addClass(b.prefix+"warning");var o=setInterval(function(){a.prompt.jqib.toggleClass(b.prefix+"warning");if(p++>1){clearInterval(o);a.prompt.jqib.removeClass(b.prefix+"warning")}},100)})}else{a.prompt.close(true)}};var h=function(p){var o=(window.event)?event.keyCode:p.keyCode;if(o==27){i()}if(o==9){var q=a(":input:enabled:visible",a.prompt.jqib);var n=!p.shiftKey&&p.target==q[q.length-1];var k=p.shiftKey&&p.target==q[0];if(n||k){setTimeout(function(){if(!q){return}var r=q[k===true?q.length-1:0];if(r){r.focus()}},10);return false}}};a.prompt.position();a.prompt.style();a.prompt.jqif.click(i);d.resize({animate:false},a.prompt.position);a.prompt.jqi.find("."+b.prefix+"close").click(a.prompt.close);a.prompt.jqib.bind("keydown keypress",h).bind("promptloaded",b.loaded).bind("promptclose",b.close).bind("promptstatechanging",b.statechanging).bind("promptstatechanged",b.statechanged);a.prompt.jqif.fadeIn(b.overlayspeed);a.prompt.jqi[b.show](b.promptspeed,function(){a.prompt.jqib.trigger("promptloaded")});if(b.timeout>0){setTimeout(a.prompt.close,b.timeout)}return a.prompt.jqib};a.prompt.defaults={prefix:"jqi",classes:{box:"",fade:"",prompt:"",close:"",title:"",message:"",buttons:"",button:"",defaultButton:""},title:"",closeText:"&times;",buttons:{Ok:true},loaded:function(b){},submit:function(g,c,b,d){},close:function(g,c,b,d){},statechanging:function(b,d,c){},statechanged:function(b,c){},opacity:0.6,zIndex:999,overlayspeed:"slow",promptspeed:"fast",show:"fadeIn",focus:0,useiframe:false,top:"15%",position:{container:null,x:null,y:null,arrow:null,width:null},persistent:true,timeout:0,state:{name:null,title:"",html:"",buttons:{Ok:true},focus:0,position:{container:null,x:null,y:null,arrow:null,width:null},submit:function(g,c,b,d){return true}}};a.prompt.currentPrefix=a.prompt.defaults.prefix;a.prompt.currentStateName="";a.prompt.setDefaults=function(b){a.prompt.defaults=a.extend({},a.prompt.defaults,b)};a.prompt.setStateDefaults=function(b){a.prompt.defaults.state=a.extend({},a.prompt.defaults.state,b)};a.prompt.position=function(h){var f=a.fx.off,c=a.prompt.getCurrentState();if(!c.data("jqi")){return}var j=c.data("jqi").position,d=a(window),l=a(document.body).outerHeight(true),b=a(window).height(),m=a(document).height(),k=l>b?l:b,i=parseInt(d.scrollTop(),10)+(a.prompt.options.top.toString().indexOf("%")>=0?(b*(parseInt(a.prompt.options.top,10)/100)):parseInt(a.prompt.options.top,10));if(h!==undefined&&h.data.animate===false){a.fx.off=true}a.prompt.jqib.css({position:"absolute",height:k,width:"100%",top:0,left:0,right:0,bottom:0});a.prompt.jqif.css({position:"absolute",height:k,width:"100%",top:0,left:0,right:0,bottom:0});if(j&&j.container){var g=a(j.container).offset();if(a.isPlainObject(g)&&g.top!==undefined){a.prompt.jqi.css({position:"absolute"});a.prompt.jqi.animate({top:g.top+j.y,left:g.left+j.x,marginLeft:0,width:(j.width!==undefined)?j.width:null});i=(g.top+j.y)-(a.prompt.options.top.toString().indexOf("%")>=0?(b*(parseInt(a.prompt.options.top,10)/100)):parseInt(a.prompt.options.top,10));a("html,body").animate({scrollTop:i},"slow","swing",function(){})}}else{if(j&&j.width){a.prompt.jqi.css({position:"absolute",left:"50%"});a.prompt.jqi.animate({top:j.y||i,left:j.x||"50%",marginLeft:((j.width/2)*-1),width:j.width})}else{a.prompt.jqi.css({position:"absolute",top:i,left:"50%",marginLeft:((a.prompt.jqi.outerWidth()/2)*-1)})}}if(h!==undefined&&h.data.animate===false){a.fx.off=f}};a.prompt.style=function(){a.prompt.jqif.css({zIndex:a.prompt.options.zIndex,display:"none",opacity:a.prompt.options.opacity});a.prompt.jqi.css({zIndex:a.prompt.options.zIndex+1,display:"none"});a.prompt.jqib.css({zIndex:a.prompt.options.zIndex})};a.prompt.get=function(b){return a("."+a.prompt.currentPrefix)};a.prompt.addState=function(h,o,j){var d="",c=null,m="",l="",b=a.prompt.options,f=a("."+a.prompt.currentPrefix+"states"),e,n,g=0;o=a.extend({},a.prompt.defaults.state,{name:h},o);if(o.position.arrow!==null){m='<div class="'+b.prefix+"arrow "+b.prefix+"arrow"+o.position.arrow+'"></div>'}if(o.title&&o.title!==""){l='<div class="lead '+b.prefix+"title "+b.classes.title+'">'+o.title+"</div>"}d+='<div id="'+b.prefix+"state_"+h+'" class="'+b.prefix+'state" data-jqi-name="'+h+'" style="display:none;">'+m+l+'<div class="'+b.prefix+"message "+b.classes.message+'">'+o.html+'</div><div class="'+b.prefix+"buttons "+b.classes.buttons+'"'+(a.isEmptyObject(o.buttons)?'style="display:none;"':"")+">";for(e in o.buttons){n=o.buttons[e],defbtn=o.focus===g?(a.prompt.currentPrefix+"defaultbutton "+b.classes.defaultButton):"";if(typeof n=="object"){d+='<button class="'+b.classes.button+" "+defbtn;if(typeof n.classes!=="undefined"){d+=" "+(a.isArray(n.classes)?n.classes.join(" "):n.classes)+" "}d+='" name="'+b.prefix+"_"+h+"_button"+n.title.replace(/[^a-z0-9]+/gi,"")+'" id="'+b.prefix+"_"+h+"_button"+n.title.replace(/[^a-z0-9]+/gi,"")+'" value="'+n.value+'">'+n.title+"</button>"}else{d+='<button class="'+b.classes.button+" "+defbtn+'" name="'+b.prefix+"_"+h+"_button"+e+'" id="'+b.prefix+"_"+h+"_button"+e+'" value="'+n+'">'+e+"</button>"}g++}d+="</div></div>";c=a(d);c.data("jqi",o).bind("promptsubmit",o.submit);if(j!==undefined){f.find("#"+a.prompt.currentPrefix+"state_"+j).after(c)}else{f.append(c)}return c};a.prompt.removeState=function(c){var b=a.prompt.getState(c),d=function(){b.remove()};if(b.length===0){return false}if(b.is(":visible")){if(b.next().length>0){a.prompt.nextState(d)}else{a.prompt.prevState(d)}}else{b.slideUp("slow",d)}return true};a.prompt.getState=function(b){return a("#"+a.prompt.currentPrefix+"state_"+b)};a.prompt.getStateContent=function(b){return a.prompt.getState(b)};a.prompt.getCurrentState=function(){return a.prompt.getState(a.prompt.getCurrentStateName())};a.prompt.getCurrentStateName=function(){return a.prompt.currentStateName};a.prompt.goToState=function(g,h){var d=a.prompt.get(),b=d.data("jqi"),c=a.prompt.getState(g),f=c.data("jqi"),e=new a.Event("promptstatechanging");a.prompt.jqib.trigger(e,[a.prompt.getCurrentStateName(),g]);if(!e.isDefaultPrevented()&&c.length>0){a("."+a.prompt.currentPrefix+"state").not(c).slideUp(b.promptspeed).find("."+a.prompt.currentPrefix+"arrow").fadeOut();a.prompt.currentStateName=f.name;c.slideDown(b.promptspeed,function(){var i=a(this);if(typeof(f.focus)==="string"){i.find(f.focus).focus()}else{i.find("."+a.prompt.currentPrefix+"defaultbutton").focus()}i.find("."+a.prompt.currentPrefix+"arrow").fadeIn(b.promptspeed);if(typeof h=="function"){a.prompt.jqib.bind("promptstatechanged.tmp",h)}a.prompt.jqib.trigger("promptstatechanged",[g]);if(typeof h=="function"){a.prompt.jqib.unbind("promptstatechanged.tmp")}});a.prompt.position()}return c};a.prompt.nextState=function(c){var b=a("#"+a.prompt.currentPrefix+"state_"+a.prompt.getCurrentStateName()).next();return a.prompt.goToState(b.attr("id").replace(a.prompt.currentPrefix+"state_",""),c)};a.prompt.prevState=function(c){var b=a("#"+a.prompt.currentPrefix+"state_"+a.prompt.getCurrentStateName()).prev();a.prompt.goToState(b.attr("id").replace(a.prompt.currentPrefix+"state_",""),c)};a.prompt.close=function(d,c,e,b){a.prompt.jqib.fadeOut("fast",function(){if(d){a.prompt.jqib.trigger("promptclose",[c,e,b])}a.prompt.jqib.remove();a("window").unbind("resize",a.prompt.position)})};a.fn.extend({prompt:function(b){if(b==undefined){b={}}if(b.withDataAndEvents==undefined){b.withDataAndEvents=false}a.prompt(a(this).clone(b.withDataAndEvents).html(),b)}})})(jQuery);