pkrss.cls.newstype_newspaper_image3d=function(){pkrss.cls.newstype_module_base.call(this);this.name="imagenews3d";this.text="Image 3d news";this.actived=false;this.model=null;this.container=null;this.containerid="image3dnews_info";this.oldparent=null};pkrss.cls.newstype_newspaper_image3d.prototype.init=function(c,a){if(this.model){return}this.model=c;this.container=a;pkrss.q("#plugin_container").append('<div id="'+this.containerid+'" style="left: 0;top: 100px;right: 0;bottom: 0;position: fixed;"></div>');pkrss.utils.html.addCssContent("		.pkico-nenwsmodule-imagenews3d{			background-position: -96px -288px; !important;		}	.pkthreejs_container .topmenu {		position: absolute;		top: 20px;		width: 100%;		text-align: center;	}");var d="pkrss.cls.treejs_grid";if(pkrss.getObjFromNamespace(d)){this.init2();return}var b=this;pkrss.utils.html.loadPlateformJs([{ns:d,src:pkrss.ajax.pkurlresurlpath+"js/modelview/threejs_grid.js"}],function(e){if(!e){return}b.init2();b=null;changenow=null})};pkrss.cls.newstype_newspaper_image3d.prototype.init2=function(){var b=new pkrss.cls.treejs_grid();var a=this;b.check(function(c){a.onChecked(b);a=null})};pkrss.cls.newstype_newspaper_image3d.prototype.onChecked=function(b){this.grid=b;var e=pkrss.q("#"+this.containerid);this.grid.create(e);var c='<div class="topmenu">					<button class="defaultpos">'+pkgetLocaleString("Origin")+'</button>					<button class="more">'+pkgetLocaleString("MORE")+"</button>				</div>";var a=this;var d=e.find(".pkthreejs_container").append(c);d.find(".more").on("click",function(){a.loadrssitem(true)});d.find(".defaultpos").on("click",function(){a.grid.defaultCameraPosition()});if(this.actived){this.loadrssitem(false)}pkrss.model.newstype.module.addmodule(this);pkrss.model.newstype.module.changemodule(this.name)};pkrss.cls.newstype_newspaper_image3d.prototype.onActive=function(){this.actived=true;if(!this.model){return}var a=pkrss.q("#"+this.containerid);if(!this.oldparent){this.oldparent=a.parent()}this.container.append(a);if(this.grid){if(!this.grid.isCreated()){this.grid.create(pkrss.q("#"+this.containerid))}this.loadrssitem(false)}pkrss.event.bind(pkrss.model.event.tableChanged,this.onCatalogTableChanged)};pkrss.cls.newstype_newspaper_image3d.prototype.onDeactive=function(){this.actived=false;var a=pkrss.q("#"+this.containerid);this.oldparent.append(a);if(this.grid){this.grid.destroy()}pkrss.event.unbind(pkrss.model.event.tableChanged,this.onCatalogTableChanged)};pkrss.cls.newstype_newspaper_image3d.prototype.onCatalogTableChanged=function(){pkrss.model.newstype.newspaper.image3d.loadrssitem(false)};pkrss.cls.newstype_newspaper_image3d.prototype.loadrssitem=function(a){if(!this.actived){return}if(!a){if(this.grid){this.grid.empty()}}var b=this;pkrss.ui.showLoading();this.model.loadPageData(function(c){if(b.actived){b.onHandle(c)}b=null;pkrss.ui.hideLoading()},!a,3)};pkrss.cls.newstype_newspaper_image3d.prototype.onHandle=function(a){if(a&&a.length){this.grid.append(a,function(d){if(d.img&&d.img.length){for(var b in d.img){imgitem=d.img[b];var c='<img src="'+imgitem.url+'" title="'+d.title+'" width="142px" height="182px" onclick="return pkrss.model.newstype.newspaper.image3d.onItemClick('+d.id+')" />';return pkrss.q(c)[0]}}return pkrss.q("<div/>")[0]})}else{}};pkrss.cls.newstype_newspaper_image3d.prototype.onItemClick=function(b){var a=this;pkrss.ui._loadimpromptu(function(){var c=a.model.getItemById(b);a=null;if(!c){return}jQuery.prompt(c.description,{title:c.title})});return false};pkrss.define("pkrss.model.newstype.newspaper",{image3d:new pkrss.cls.newstype_newspaper_image3d()});