pkrss.model.treejs_grid_param={controlsList:[],gridList:[]};pkrss.cls.treejs_grid=function(){if(!pkrss.model.treejs_grid_param.initedcss){this.initcss();pkrss.model.treejs_grid_param.initedcss=true}if(!pkrss.model.treejs_grid_param.initedjs){this.initjs();pkrss.model.treejs_grid_param.initedjs=true}this.empty()};pkrss.cls.treejs_grid.prototype.initcss=function(){pkrss.utils.html.addCssContent(".pkthreejs_container{		width:100%;		height:100%;}.pkthreejs_grid_container { 		background-color: #000000;		margin: 0;		font-family: Arial;		overflow: hidden;		width:100%;		height:100%;	}	.pkthreejs_container a {		color: #ffffff;	}	.pkthreejs_container .menu {		position: absolute;		bottom: 20px;		width: 100%;		text-align: center;	}	.pkthreejs_container .element {		width: 140px;		height: 180px;		box-shadow: 0px 0px 20px rgba(0,255,255,0.5);		border: 1px solid rgba(127,255,255,0.25);		cursor: default;	}	.pkthreejs_container .element:hover {		box-shadow: 0px 0px 20px rgba(0,255,255,0.75);		border: 1px solid rgba(127,255,255,0.75);	}	.pkthreejs_container button {		color: rgba(127,255,255,0.75);		background: transparent;		outline: 1px solid rgba(127,255,255,0.75);		border: 0px;		padding: 5px 10px;		cursor: pointer;	}	.pkthreejs_container button:hover {		background-color: rgba(0,255,255,0.5);	}	.pkthreejs_container button:active {		color: #000000;		background-color: rgba(0,255,255,0.75);	}")};pkrss.cls.treejs_grid.prototype.initjs=function(){var a=[];a.push({ns:"THREE",src:pkrss.ajax.pkurlresurlpath+"js/third/threejs/three.js"});a.push({ns:"TWEEN",src:pkrss.ajax.pkurlresurlpath+"js/third/threejs/libs/tween.js",depends:["THREE"]});a.push({ns:"THREE.TrackballControls",src:pkrss.ajax.pkurlresurlpath+"js/third/threejs/controls/TrackballControls.js",depends:["TWEEN"]});a.push({ns:"THREE.CSS3DObject",src:pkrss.ajax.pkurlresurlpath+"js/third/threejs/renderers/CSS3DRenderer.js",depends:["THREE.TrackballControls"]});pkrss.utils.html.loadPlateformJs(a)};pkrss.cls.treejs_grid.prototype.check=function(a){if(pkrss.getObjFromNamespace("THREE.CSS3DObject")!=null){a(true);return}new pkrss.timer.interval2(200,30,function(){return pkrss.getObjFromNamespace("THREE.CSS3DObject")!=null},a)};pkrss.cls.treejs_grid.prototype.create=function(a){var d='		<div class="pkthreejs_container">			<div class="pkthreejs_grid_container"></div>			<div class="menu">				<button class="table">'+pkgetLocaleString("TABLE")+'</button>				<button class="sphere">'+pkgetLocaleString("SPHERE")+'</button>				<button class="helix">'+pkgetLocaleString("HELIX")+'</button>				<button class="grid">'+pkgetLocaleString("GRID")+"</button>			</div>		</div>";this.parent=a;a.empty();this.container=a.append(d).find(".pkthreejs_container");this.gridcontainer=this.container.find(".pkthreejs_grid_container");var c=this.container.find(".table")[0];var b=this;c.addEventListener("click",function(e){b.transform(b.targets.table,2000)},false);c=this.container.find(".sphere")[0];c.addEventListener("click",function(e){b.transform(b.targets.sphere,2000)},false);c=this.container.find(".helix")[0];c.addEventListener("click",function(e){b.transform(b.targets.helix,2000)},false);c=this.container.find(".grid")[0];c.addEventListener("click",function(e){b.transform(b.targets.grid,2000)},false);window.addEventListener("resize",function(){b.onWindowResize()},false);pkrss.model.treejs_grid_param.gridList.push(this)};pkrss.cls.treejs_grid.prototype.isCreated=function(){return this.container!=null};pkrss.cls.treejs_grid.prototype.destroy=function(){this.empty();if(this.camera){delete this.camera;this.camera=null}if(this.scene){delete this.scene;this.scene=null}if(this.renderer){delete this.renderer;this.renderer=null}for(var a in pkrss.model.treejs_grid_param.controlsList){if(pkrss.model.treejs_grid_param.controlsList[a]==this.controls){pkrss.model.treejs_grid_param.controlsList.splice(a,1)}}if(this.controls){delete this.controls;this.controls=null}for(var a in pkrss.model.treejs_grid_param.gridList){if(pkrss.model.treejs_grid_param.gridList[a]==this){pkrss.model.treejs_grid_param.gridList.splice(a,1)}}if(this.parent){this.parent.empty()}this.container=null;this.gridcontainer=null};pkrss.cls.treejs_grid.prototype.empty=function(){if(typeof(TWEEN)!="undefined"){TWEEN.removeAll()}if(this.renderer&&this.renderer.cameraElement){pkrss.q(this.renderer.cameraElement).empty()}if(this.objects){for(var a in this.objects){if(this.scene){this.scene.remove(this.objects[a])}delete this.objects[a]}}this.objects=[];this.currentTransformTargets=null;if(this.targets){for(var a in this.targets.table){delete this.targets.table[a]}for(var a in this.targets.sphere){delete this.targets.sphere[a]}for(var a in this.targets.helix){delete this.targets.helix[a]}for(var a in this.targets.grid){delete this.targets.grid[a]}}this.targets={table:[],sphere:[],helix:[],grid:[]}};pkrss.cls.treejs_grid.prototype.count=function(){return this.objects?this.objects.length:0};pkrss.cls.treejs_grid.prototype.defaultCameraPosition=function(){var a=this.camera;if(!a||!this.container){return}a.fov=75;a.aspect=this.container.width()/this.container.height();a.near=1;a.far=5000;a.position.x=0;a.position.y=0;a.position.z=1800;a.updateProjectionMatrix()};pkrss.cls.treejs_grid.prototype.append=function(r,p){var b=this.container.width();var q=this.container.height();if(pkrss.getObjFromNamespace("THREE.CSS3DObject")==null){return}if(!this.camera){var a=this.container;this.camera=new THREE.PerspectiveCamera(75,b/q,1,5000);this.camera.position.z=1800}else{}if(!this.scene){this.scene=new THREE.Scene()}var t=this.objects.length;for(var m=0;m<r.length;m++){var s=r[m];var k=document.createElement("div");k.className="element";k.style.backgroundColor="rgba(0,127,127,"+(Math.random()*0.5+0.25)+")";if(p){var j=p(s);if(j){k.appendChild(j)}}var g=new THREE.CSS3DObject(k);g.position.x=Math.random()*4000-2000;g.position.y=Math.random()*4000-2000;g.position.z=Math.random()*4000-2000;this.scene.add(g);this.objects.push(g)}var o=this.objects.length;var h=q/150;for(var m=t;m<this.objects.length;m++){var g=new THREE.Object3D();g.position.x=((m/h+1)*160)-1040;g.position.y=-((m%h+1)*200)+600;g.position.z=1000;this.targets.table.push(g)}var e=new THREE.Vector3();for(var m=t,f=this.objects.length;m<f;m++){var n=Math.acos(-1+(2*m)/f);var d=Math.sqrt(f*Math.PI)*n;var g=new THREE.Object3D();g.position.x=1000*Math.cos(d)*Math.sin(n);g.position.y=1000*Math.sin(d)*Math.sin(n);g.position.z=1000*Math.cos(n);e.copy(g.position).multiplyScalar(2);g.lookAt(e);this.targets.sphere.push(g)}var e=new THREE.Vector3();for(var m=t,f=this.objects.length;m<f;m++){var n=m*0.175+Math.PI;var g=new THREE.Object3D();g.position.x=1100*Math.sin(n);g.position.y=-(m*8)+450;g.position.z=1100*Math.cos(n);e.copy(g.position);e.x*=2;e.z*=2;g.lookAt(e);this.targets.helix.push(g)}for(var m=t;m<this.objects.length;m++){var g=new THREE.Object3D();g.position.x=((m%5)*400)-800;g.position.y=(-(Math.floor(m/5)%5)*400)+800;g.position.z=(Math.floor(m/25))*1000-2000;this.targets.grid.push(g)}if(!this.renderer){this.renderer=new THREE.CSS3DRenderer();this.renderer.setSize(b,q);this.renderer.domElement.style.position="absolute";this.gridcontainer.append(this.renderer.domElement)}if(!this.controls){this.controls=new THREE.TrackballControls(this.camera,this.renderer.domElement);this.controls.rotateSpeed=0.5;this.controls.addEventListener("change",pkrss.model.treejs_grid_param.render);this.transform(this.targets.table,5000);pkrss.model.treejs_grid_param.controlsList.push(this.controls)}if(!pkrss.model.treejs_grid_param.init_animateed){pkrss.model.treejs_grid_param.init_animateed=true;pkrss.model.treejs_grid_param.animate()}else{if(!this.currentTransformTargets){this.currentTransformTargets=this.targets.table}this.transform(this.currentTransformTargets,2000)}};pkrss.cls.treejs_grid.prototype.transform=function(a,e){TWEEN.removeAll();this.currentTransformTargets=a;if(!a){return}for(var c=0;c<this.objects.length;c++){var b=this.objects[c];var d=a[c];new TWEEN.Tween(b.position).to({x:d.position.x,y:d.position.y,z:d.position.z},Math.random()*e+e).easing(TWEEN.Easing.Exponential.InOut).start();new TWEEN.Tween(b.rotation).to({x:d.rotation.x,y:d.rotation.y,z:d.rotation.z},Math.random()*e+e).easing(TWEEN.Easing.Exponential.InOut).start()}new TWEEN.Tween(this).to({},e*2).onUpdate(pkrss.model.treejs_grid_param.render).start()};pkrss.cls.treejs_grid.prototype.onWindowResize=function(){if(!this.camera){return}var b=this.container.width();var a=this.container.height();this.camera.aspect=b/a;this.camera.updateProjectionMatrix();this.renderer.setSize(b,a)};pkrss.model.treejs_grid_param.animate=function(){requestAnimationFrame(pkrss.model.treejs_grid_param.animate);TWEEN.update();for(var a in pkrss.model.treejs_grid_param.controlsList){pkrss.model.treejs_grid_param.controlsList[a].update()}};pkrss.model.treejs_grid_param.render=function(){var a;for(var b in pkrss.model.treejs_grid_param.gridList){a=pkrss.model.treejs_grid_param.gridList[b];if(a.renderer&&a.scene&&a.camera){a.renderer.render(a.scene,a.camera)}}};